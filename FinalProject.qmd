---
title: "Stat 331 Final Project"
format: 
  html:
    embed-resources: true
    code-tools: true
    toc: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---
# Introduction

```{r setup}
#| include: false
library(tidyverse)
```
 **Data and Variable Descriptions**:
 
We chose to explore the relationship between child mortality rates and average daily income by country from the years 1800 to 2023. In order to find data for this, we selected two datasets from Gapminder, one for each of our quantitative variables. For our first variable, we are measuring child mortality by country as the number of 0-5 year olds dying per 1000 babies born, and for income we are measuring average daily household per capita income adjusted for inflation and price. Without controlling for inflation, we would see a near constant increase in income by year, but by controlling for income by expressing every income in 2017 US dollars we can better compare different countries since we are standardizing the value of the dollar across all data points. 

It is also important to consider the origins and logic behind the procurement of these datasets as Gapminder has extrapolated and made rough estimates of changes in both of these datasets that are not necessarily accurate. Within the child mortality rates dataset, Gapminder combined data from multiple sources ranging in methodology as some of the mortality rates are calculated based on regression analysis while others are simply projected estimates. This, coupled with the varying yearly ranges leads to a patchwork of datasets to create the dataset we are analyzing which could eliminate the relevancy of our analysis. The mean income per capita dataset faces a similar problem as the various countrys' income distributions are calculated via different methods based on the prevalency of data. If countries do not have a mean income indicator from the World Bank with data from household surveys, daily incomes per household are instead estimated based on the country's GDP per capita. These factors should be considered in assessing the relevancy, accuracy, and value of our analysis between the two variables in question.

**Hypothesis:** 

  Our hypothesis is that we will see an inverse relationship between each countries child mortality rate and average daily income, or that as income increases, child mortality decreases by country. We would expect childcare and medical care to be better and more readily available in countries as income increases, decreasing the child mortality rate. A greater daily household income also indicates a larger economy with better technology to treat emergencies leading to improved citizen welfare. While there are numerous other confounding variables that also effect child mortality rate, we will only focus on the relationship between average daily income and child mortality rate, and it is important to acknowledge that our analysis may prove association but not necessarily causation between the two varaibles. 

# Section 1.1: Data Cleaning and Pivoting
```{r download data}
#| include: false
child_mortality <- read_csv("https://raw.githubusercontent.com/drewclanton/STAT331_Project/main/child_mortality_0_5_year_olds_dying_per_1000_born.csv")
income <- read_csv('https://raw.githubusercontent.com/drewclanton/STAT331_Project/main/mincpcap_cppp.csv')
```

Our goal in data cleaning is looking to create clean and tidy data that we can easily analyze. First, we checked for any missing values in the data:
```{r}
sum(is.na(income))
sum(is.na(child_mortality))
```
We found that our daily income data set (income) has zero missing values, but our child mortality data set is missing 1800 entries. 

```{r}
child_mortality |>
  slice(1:5)
```
We investigated the nature of our missing values, learning that they are not random, but rather some countries do not have any values for any years. These countries cannot be included because we need at least some entries to perform analysis on, so we will ommit them.

```{r}
#data cleaning on child mortality data set
child_mortality <- child_mortality |>
  na.omit() |>
  pivot_longer(cols =`1800`:`2100`,
               names_to = "year",
               values_to = "child_mortality") |>
  filter(year<2024)

#data cleaning on income set
income <- income |>
  pivot_longer(cols =`1800`:`2100`,
               names_to = "year",
               values_to = "daily_income") |>
  filter(year<2024)

  
```

Our next step was to pivot our data to a long format where we will have a single column for our variable of interest, meaning that each observation will have as its variables: Country, Year, and Variable of Interest (income or child_mortality). This format will make our data easier to join as well as making it easier to filter out our specified years. Given the extrapolation in our data set, we will limit our observations to the period of 1800-2023, removing all future speculative entries. After this step, we are left with two much longer data sets, as each country will now have 2023 observations, one for each year. 


# Section 1.3: Joining Datasets

```{r}
data <- child_mortality |>
  left_join(income, join_by(country==country,
                            year==year))
```

In combining our data sets, we chose to only include entries that were present in the child mortality dataset with no missing values. Since our income data set has no missing values, we will not have to worry about any NAs in our data. We ended up with 185 countries in our final data set, meaning that we only removed 12 countries from the set for the reason of having no data about child_mortality. 